<!DOCTYPE html>
<html lang="en">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <script src="show.js"></script>
</head>
<body>
<h1>Admin</h1>

<div style="text-align: right; margin-right: 50px ">
    <div style="margin-right: -17px">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTGkvHnw-e8xkeN27LPJn5JJvw4XbIgOM8OEw&usqp=CAU"
             alt="" width="100" height="100"><br>
    </div>
    <div>
        <span id="name" style="font-size: 20px"></span>
    </div>
    <div>
        <a href="" onclick="logOut()">Log Out</a>
    </div>
</div>


<a href="" onclick="usersForm()">Add new Users</a>,
<a href="" onclick="classesForm()">Add new Class</a>,
<a href="" onclick="subjectForm()">Add new Subject</a>,
<a href="" onclick="tuitionFeeForm()">Add new TuitionFee</a>


<div id="form">
</div>
</body>
<script type="text/javascript">
    $(document).ready(function () {
        let fullName = window.sessionStorage.getItem('NAME_KEY')
        document.getElementById("name").innerHTML = fullName;

        let roles = JSON.parse(window.sessionStorage.getItem('ROLE_KEY'));
        if (roles === null) {
            window.location.href = 'login.html';
        }
        for (let i = 0; i < roles.length; i++) {
            if (roles[i].authority !== 'ADMIN') {
                window.location.href = 'login.html';
                return
            }
        }
    })


    function tuitionFeeForm() {
        event.preventDefault();
        document.getElementById("form").innerHTML =
            `<div>
    <fieldset style="width: 60%">
        <legend>Information</legend>
        <form action="">
            <table>
                <div>
                    <span style="color: red" id="success"></span>
                </div>
                <tr>
                    <td>Lớp:</td>
                    <td><select id="classes" onchange="showStudentByClassesId()"></select></td>
                </tr>
                <tr>
                    <td>Học sinh</td>
                    <td><select id="users"></select></td>
                </tr>
                <tr>
                    <td>Đợt đóng:</td>
                    <td>
                        <select id="dotDog">
                            <option value="Đợt 1">Đợt 1</option>
                            <option value="Đợt 2">Đợt 2</option>
                            <option value="Đợt 3">Đợt 3</option>
                            <option value="Đợt 4">Đợt 4</option>
                            <option value="Đợt 5">Đợt 5</option>
                            <option value="Đợt 6">Đợt 6</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Ngày đóng:</td>
                    <td><input type="date" id="dayDog"></td>
                </tr>
                <tr>
                    <td>Số tiền:</td>
                    <td><input type="number" id="money"></td>
                </tr>
                <tr>
                    <td>Tình trạng:</td>
                    <td><select id="status">
                        <option value="Nợ">Nợ</option>
                        <option value="Đã đóng">Đã đóng</option>
                    </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button onclick="addTuitionFee()">Submit</button>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
</div>`
        showAllClasses()
    }

    function addTuitionFee() {
        event.preventDefault();
        let dotDog = $('#dotDog').val();
        let dayDog = $('#dayDog').val();
        let money = $('#money').val();
        let status = $('#status').val();
        let usersId = $('#users').val();

        let tuitionFee = {
            dotDog: dotDog,
            dayDog: dayDog,
            money: money,
            status: status,
            usersId: usersId
        }
        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/tuitionFee/create',
            method: 'POST',
            data: JSON.stringify(tuitionFee),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    document.getElementById("success").innerHTML = "Lưu học phí thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên lớp học đã tồn tại";
                }
            }
        })
    }


    function usersForm() {
        event.preventDefault()
        document.getElementById("form").innerHTML =
            `
<div>
    <fieldset style="width: 60%">
        <legend>Information</legend>
        <form action="">
            <div>
                <span style="color: red" id="success"></span>
            </div>
            <table>
                <tr>
                    <td>FullName:</td>
                    <td><input type="text" id="fullName"></td>
                </tr>
                <tr>
                    <td>Email:</td>
                    <td><input type="text" id="email"></td>
                </tr>
                <tr>
                    <td>Password:</td>
                    <td><input type="text" id="password"></td>
                </tr>
                <tr>
                    <td>Phone Number:</td>
                    <td><input type="number" id="phoneNumber"></td>
                </tr>
                <tr>
                    <td>Address:</td>
                    <td><input type="text" id="address"></td>
                </tr>
                <tr>
                    <td>Date of birth:</td>
                    <td><input type="date" id="dob"></td>
                </tr>

                <tr>
                    <td>Status:</td>
                    <td>
                        <select id="status">
                            <option>--Chon--</option>
                            <option value="Đang học">Đang học</option>
                            <option value="Thôi học">Thôi học</option>
                            <option value="Đình chỉ">Đình chỉ</option>
                            <option value="Chờ chuuyển lớp">Chờ chuyển lớp</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Role:</td>
                    <td>
                        <select id="role">
                            <option value="coach">Coach</option>
                            <option value="admin">Admin</option>
                            <option value="ministry">Ministry</option>
                            <option value="student">Student</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Avatar:</td>
                    <td><input type="text" id="avatar"></td>
                </tr>
                <tr>
                    <td>Class:</td>
                    <td>
                        <select name="class" id="classes" multiple="multiple">
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button onclick="addNewUser()">Submit</button>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
</div>
            `
        showAllClasses()
    }

    function addNewUser() {
        event.preventDefault();
        let fullName = $('#fullName').val();
        let email = $('#email').val();
        let passWord = $('#password').val();
        let phoneNumber = $('#phoneNumber').val();
        let address = $('#address').val();
        let dob = $('#dob').val();
        let status = $('#status').val();
        let avatar = $('#avatar').val();

        let role = $('#role').val();
        let roles = [];
        switch (role) {
            case "student": {
                roles = ["student"];
                break;
            }
            case "admin": {
                roles = ["admin"];
                break;
            }
            case "ministry": {
                roles = ["ministry"];
                break;
            }
            case "coach": {
                roles = ["coach"];
                break;
            }
        }

        let classesIds = $('#classes').val();
        if (classesIds === []) {
            classesIds = null
        }


        let signUpForm = {
            fullName: fullName,
            email: email,
            password: passWord,
            phoneNumber: phoneNumber,
            address: address,
            dob: dob,
            status: status,
            avatar: avatar,
            roles: roles,
            classesIds: classesIds
        }

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/user/signup',
            method: 'POST',
            data: JSON.stringify(signUpForm),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên user đã tồn tại";
                }

            }
        })

    }


    function classesForm() {
        event.preventDefault()
        document.getElementById("form").innerHTML =
            `
<div>
    <fieldset style="width: 60%">
        <legend>Information</legend>
        <form action="">
            <div>
                <span style="color: red" id="success"></span>
            </div>
            <table>
                <tr>
                    <td>Class name:</td>
                    <td><input type="text" id="classesName"></td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button type="submit" onclick="addNewClasses()">Submit</button>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
</div>
            `
    }

    function addNewClasses() {
        event.preventDefault();
        let name = $('#classesName').val();
        let classes = {name: name}

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/classes/create',
            method: 'POST',
            data: JSON.stringify(classes),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên lớp học đã tồn tại";
                }
            }
        })
    }


    function subjectForm() {
        event.preventDefault()
        document.getElementById("form").innerHTML =
            `
<div>
    <fieldset style="width: 60%">
        <legend>Information</legend>
        <form action="">
            <div>
                <span style="color: red" id="success"></span>
            </div>
            <table>
                <tr>
                    <td>Subject name:</td>
                    <td><input type="text" id="subjectName"></td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button type="submit" onclick="addNewSubject()">Submit</button>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
</div>
            `
    }

    function addNewSubject() {
        event.preventDefault();
        let name = $('#subjectName').val();
        let subject = {name: name}

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/subject/create',
            method: 'POST',
            data: JSON.stringify(subject),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên môn học đã tồn tại";
                }
            }

        })
    }


    function logOut() {
        event.preventDefault()
        logOutConfirm()
    }

</script>
</html>
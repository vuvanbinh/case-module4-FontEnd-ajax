<!DOCTYPE html>
<html lang="en">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>


<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <script src="show.js"></script>
</head>
<body>
<div style="background-color: azure">
    <h1 style="text-align: center">Admin</h1>
    <div style="text-align: right; margin-right: 50px " id="result1"></div>
</div>
<div style="background-color: #eaeaea;height: 50px">
    <ul class="nav justify-content-center">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#" onclick="usersForm()">User</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" onclick="classesForm()">Class</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" onclick="subjectForm()">Subject</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" onclick="tuitionFeeForm()">TuitionFee</a>
        </li>
    </ul>
</div>

<div>
    <span style="font-size: 20px;color: red" id="success"></span><br>
</div>
    <div id="form"></div>
    <br><br><br>
</body>
<script type="text/javascript">
    let avatar = window.sessionStorage.getItem('AVATAR_KEY');
    viewAccount(avatar);
    $(document).ready(function () {
        let fullName = window.sessionStorage.getItem('NAME_KEY')
        document.getElementById("name").innerHTML = fullName;

        let roles = JSON.parse(window.sessionStorage.getItem('ROLE_KEY'));
        if (roles === null) {
            window.location.href = 'login.html';
        }
        for (let i = 0; i < roles.length; i++) {
            if (roles[i].authority !== 'ADMIN') {
                window.location.href = 'login.html';
                return
            }
        }
    })

    function tuitionFeeForm() {
        event.preventDefault();
        document.getElementById("success").innerHTML ="";
        document.getElementById("form").innerHTML =
            `<div style="width: 60%;padding-left: 30px">
    <form>
        <div class="mb-3">
            <label for="classes" class="form-label"><b>Class:</b></label>
            <select class="form-select" aria-label="Default select example"
                    onchange="showStudentByClassesId()" id="classes"></select>
        </div>
        <div class="mb-3">
            <label for="users" class="form-label"><b>Student:</b></label>
            <select class="form-select" aria-label="Default select example" id="users"></select>
        </div>
        <div class="mb-3">
            <label for="dotDog" class="form-label"><b>DotDog:</b></label>
            <select class="form-select" aria-label="Default select example" id="dotDog">
                <option value="Đợt 1">Đợt 1</option>
                <option value="Đợt 2">Đợt 2</option>
                <option value="Đợt 3">Đợt 3</option>
                <option value="Đợt 4">Đợt 4</option>
                <option value="Đợt 5">Đợt 5</option>
                <option value="Đợt 6">Đợt 6</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="dayDog" class="form-label"><b>DayDog:</b></label>
            <input type="date" class="form-control" id="dayDog">
        </div>
        <div class="mb-3">
            <label for="money" class="form-label"><b>Money:</b></label>
            <input type="number" class="form-control" id="money">
        </div>
        <div class="mb-3">
            <label for="status" class="form-label"><b>Status:</b></label>
            <select class="form-select" aria-label="Default select example" id="status">
                <option >--Chọn--</option>
                <option value="Chưa đóng">Chưa đóng</option>
                <option value="Nợ">Nợ</option>
                <option value="Đã đóng">Đã đóng</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary" onclick="addTuitionFee()">Submit</button>
    </form>
</div>`
        showAllClasses()
    }

    function addTuitionFee() {
        event.preventDefault();
        let dotDog = $('#dotDog').val();
        let dayDog = $('#dayDog').val();
        let money = $('#money').val();
        let status = $('#status').val();
        let usersId = $('#users').val();

        let tuitionFee = {
            dotDog: dotDog,
            dayDog: dayDog,
            money: money,
            status: status,
            usersId: usersId
        }
        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/tuitionFee/create',
            method: 'POST',
            data: JSON.stringify(tuitionFee),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    tuitionFeeForm()
                    document.getElementById("success").innerHTML = "Lưu học phí thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên lớp học đã tồn tại";
                }
            }
        })
    }



    function usersForm() {
        event.preventDefault()
        document.getElementById("success").innerHTML ="";
        document.getElementById("form").innerHTML =
            `
<div style="width: 60%;padding-left: 30px">
    <form>
        <div class="mb-3">
        <span style="font-size: 25px;color: red" id="error"></span>
        </div>
        <div class="mb-3">
            <label for="fullName" class="form-label"><b>Full name:</b></label>
            <input type="text" class="form-control" id="fullName">
        </div>
        <div class="mb-3">
            <label for="email" class="form-label"><b>Email:</b></label>
            <input type="email" class="form-control" id="email">
        </div>
        <div class="mb-3">
            <label for="password" class="form-label"><b>Email:</b></label>
            <input type="password" class="form-control" id="password">
        </div>
        <div class="mb-3">
            <label for="phoneNumber" class="form-label"><b>Phone number:</b></label>
            <input type="number" class="form-control" id="phoneNumber">
        </div>
        <div class="mb-3">
            <label for="address" class="form-label"><b>Address:</b></label>
            <input type="text" class="form-control" id="address">
        </div>
        <div class="mb-3">
            <label for="dob" class="form-label"><b>Date of birth:</b></label>
            <input type="date" class="form-control" id="dob">
        </div>
        <div class="mb-3">
            <label for="status" class="form-label"><b>Status:</b></label>
            <select class="form-select" aria-label="Default select example" id="status">
                <option selected>Open this select menu</option>
                <option value="Đang học">Đang học</option>
                <option value="Thôi học">Thôi học</option>
                <option value="Đình chỉ">Đình chỉ</option>
                <option value="Chờ chuuyển lớp">Chờ chuyển lớp</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="role" class="form-label"><b>Role:</b></label>
            <select class="form-select" aria-label="Default select example" id="role">
                <option selected>Open this select menu</option>
                <option value="coach">Coach</option>
                <option value="admin">Admin</option>
                <option value="ministry">Ministry</option>
                <option value="student">Student</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="avatar" class="form-label"><b>Avatar:</b></label>
            <span class="input-group-text">Image</span>
                <progress value="0" max="100" id="uploader">0%</progress>
                <input type="file" value="upload" accept=".jpg" id="fileButton">
                <div id="imgDiv"></div>
<!--            <input type="file" class="form-control" id="avatar">-->
        </div>
        <div class="mb-3">
            <label for="classes" class="form-label"><b>Class:</b></label>
            <select class="form-select" aria-label="Default select example" multiple id="classes"></select>
        </div>
        <button type="submit" class="btn btn-primary" onclick="addNewUser()">Submit</button>
    </form>
</div>
            `
        showAllClasses()
    }

    function addNewUser() {
        event.preventDefault();
        let fullName = $('#fullName').val();
        if (fullName===''){
            document.getElementById("error").innerText="Please enter your full name!"
            return false;
        }
        let email = $('#email').val();
        if (email===''){
            document.getElementById("error").innerText="Please enter your Email!"
            return false;
        }
        let passWord = $('#password').val();
        if (passWord.length<6){
            document.getElementById("error").innerText="Please enter your password, **Password length must be atleast 8 characters!"
            return false;
        }
        let phoneNumber = $('#phoneNumber').val();
        let address = $('#address').val();
        let dob = $('#dob').val();
        let status = $('#status').val();
        let avatar = resultImage();

        let role = $('#role').val();
        let roles = [];
        switch (role) {
            case "student": {
                roles = ["student"];
                break;
            }
            case "admin": {
                roles = ["admin"];
                break;
            }
            case "ministry": {
                roles = ["ministry"];
                break;
            }
            case "coach": {
                roles = ["coach"];
                break;
            }
        }

        let classesIds = $('#classes').val();
        if (classesIds === []) {
            classesIds = null
        }


        let signUpForm = {
            fullName: fullName,
            email: email,
            password: passWord,
            phoneNumber: phoneNumber,
            address: address,
            dob: dob,
            status: status,
            avatar: avatar,
            roles: roles,
            classesIds: classesIds
        }

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/user/signup',
            method: 'POST',
            data: JSON.stringify(signUpForm),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    usersForm()
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên user đã tồn tại";
                }

            }
        })

    }



    function classesForm() {
        event.preventDefault()
        document.getElementById("success").innerHTML ="";
        document.getElementById("form").innerHTML =
            `
<div style="width: 60%;padding-left: 30px">
    <form>
        <div class="mb-3">
            <label for="subjectName" class="form-label"><b>Class Name:</b></label>
            <input type="text" class="form-control" id="classesName" aria-describedby="emailHelp">
        </div>
        <button type="submit" class="btn btn-primary" onclick="addNewClasses()">Submit</button>
    </form>
</div>
            `
    }

    function addNewClasses() {
        event.preventDefault();
        let name = $('#classesName').val();
        let classes = {name: name}

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/classes/create',
            method: 'POST',
            data: JSON.stringify(classes),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    classesForm();
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên lớp học đã tồn tại";
                }
            }
        })
    }



    function subjectForm() {
        event.preventDefault()
        document.getElementById("success").innerHTML ="";
        document.getElementById("form").innerHTML =
            `
<div style="width: 60%;padding-left: 30px">
    <form>
        <div class="mb-3">
            <label for="subjectName" class="form-label"><b>Subject Name:</b></label>
            <input type="text" class="form-control" id="subjectName" aria-describedby="emailHelp">
        </div>
        <button type="submit" class="btn btn-primary" onclick="addNewSubject()">Submit</button>
    </form>
</div>
            `
    }

    function addNewSubject() {
        event.preventDefault();
        let name = $('#subjectName').val();
        let subject = {name: name}

        let success = {message: "Create success!"}
        $.ajax({
            url: 'http://localhost:8080/subject/create',
            method: 'POST',
            data: JSON.stringify(subject),
            contentType: 'application/json; charset=utf8',
            success: function (data) {
                if (JSON.stringify(data) === JSON.stringify(success)) {
                    subjectForm()
                    document.getElementById("success").innerHTML = "Đăng ký thành công";
                } else {
                    document.getElementById("success").innerHTML = "Đăng ký không thành công tên môn học đã tồn tại";
                }
            }
        })
    }


    function logOut() {
        event.preventDefault()
        logOutConfirm()
    }

</script>
<script src="fireBase.js"></script>
</html>